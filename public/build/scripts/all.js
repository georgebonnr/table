function renderDays(){console.log("days",days);var e=d3.scale.linear().domain([0,d3.max(days)]).range([0,400]);d3.select(".d3").selectAll("div").data(days).enter().append("div").style("height",function(a){return e(a)+"px"}).style("width","100px").append("span").text(function(e,a){return dayNames[a]}).append("span").attr("class","label").text(function(e){return e})}function addToDays(e){var a=new Date(e).getDay();days[a]+=1}function getDateTime(e,a){e=e.value.split("-"),a.value=a.value||a.text,a=a.value.split(":");var t=a[1].slice(2);a[1]=a[1].slice(0,2),"pm"===t&&a[0]<12&&(a[0]=(parseInt(a[0],10)+12).toString());var n={year:parseInt(e[0],10),month:parseInt(e[1],10),day:parseInt(e[2],10),hour:parseInt(a[0],10),minutes:parseInt(a[1],10)};return n}function resetDate(e){e.value=(new Date).toDateInputValue()}function makeTable(e,a){e.append('<li> <div id="'+a.name+'" class="table"><div>'+a.max+"</div><span>"+a.name+"</span></div></li>")}var reservations,day,days=[0,0,0,0,0,0,0],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];$.ajax({url:"/api/v1/reservations",type:"GET"}).error(function(e){console.log(e)}).done(function(e){reservations=e.data;for(var a in reservations)addToDays(reservations[a].time);renderDays()}),datePicker=$(".datePicker")[0],Date.prototype.toDateInputValue=function(){var e=new Date(this);return e.setMinutes(this.getMinutes()-this.getTimezoneOffset()),console.log(e.toJSON()),e.toJSON().slice(0,10)},resetDate(datePicker),datePicker.onchange=function(){$(".tab.active").trigger("click")},$.ajax({url:"/api/v1/preferences",type:"GET"}).error(function(e){console.log(e)}).done(function(e){if(console.log("success",e),e=e.data?e.data:e,e.hours)for(hoursStart=hoursPicker.indexOf(e.hours.open),hoursEnd=hoursPicker.indexOf(e.hours.close),$tabs[0].firstElementChild.text=e.hours.open,index=hoursStart,index++;hoursEnd>index;)index++,$tabs.append("<a href='' class='tab'>"+hoursPicker[index]+"</a>");else $tableContaner.html("<h1>No hours have been set for this organization â€“ unable to populate time picker</h1>")}),$("#today").on("click",function(e){e.preventDefault(),resetDate(datePicker),$(".tab.active").trigger("click")}),client={},hoursPicker=["12:00am","12:30am","1:00am","1:30am","2:30am","3:00am","3:30am","4:00am","4:30am","5:00am","5:30am","6:00am","6:30am","7:00am","7:30am","8:00am","8:30am","9:00am","9:30am","10:00am","10:30am","11:00am","11:30am","12:00pm","12:30pm","1:00pm","1:30pm","2:00pm","2:30pm","3:00pm","3:30pm","4:00pm","4:30pm","5:00pm","5:30pm","6:00pm","6:30pm","7:00pm","7:30pm","8:00pm","8:30pm","9:00pm","9:30pm","10:00pm","10:30pm","11:00pm","11:30pm"],$tabs=$(".tabs"),$(".tab-content").show(),$modalNotification=$(".modal-notification"),$reservationInit=null,$(".reservationInit").on("submit",function(e){e.preventDefault();var a=$(this)[0][1].value.replace(/\D/g,"");$.ajax({url:"/api/v1/users",type:"GET",data:{phone:a}}).error(function(e){console.log(e)}).done(function(e){var a;e.data&&e.data[0]?(a=e.data[0],$reservationInit.html(""),$reservationInit.append("<h1>"+a.firstName+" "+a.lastName+"</h1>"),$reservationInit.data("person",a)):$modalNotification.text("number not found").finish().slideDown().delay(5e3).slideUp()})}),$(".reservationComplete").on("submit",function(e){e.preventDefault();var a=this[1].valueAsNumber;return a>$reservationInit.data("capacity")?$modalNotification.html("table does not have capacity").finish().slideDown().delay(5e3).slideUp():($.ajax({url:"/api/v1/reservations",type:"POST",data:{email:$reservationInit.data("person").email,phone:$reservationInit.data("person").phone,time:$reservationInit.data("dateTime"),size:a,table:$reservationInit.data("table")}}).error(function(e){console.log(e),$modalNotification.html(e.responseText).finish().slideDown().delay(5e3).slideUp()}).done(function(e){console.log("success",e),$reservationInit=null,$(".modal-close").trigger("click"),$(".tab.active").trigger("click")}),void 0)}),$tableContainer=$("#tables");var $tables;$.ajax({url:"/api/v1/tables",type:"GET"}).error(function(e){console.log(e)}).done(function(e){var a=e.data;$tableContainer.html("");for(var t=0;t<a.length;t++)makeTable($tableContainer,a[t]);$tables=$(".table"),$(".tab.active").trigger("click")}),$("#tables").on("click",".table:not(.reserved)",function(e){$(".js-btn li").trigger("click"),$(".modal-inner").addClass("reservationsModal"),$reservationInit=$(".reservationInit"),$reservationInit.data("table",e.currentTarget.lastElementChild.innerHTML),$reservationInit.data("capacity",parseInt(e.currentTarget.firstElementChild.innerHTML,10)),$reservationInit.data("dateTime",client.dateTime)}),$(".tabs").on("click",".tab",function(e){e.preventDefault();var a=getDateTime(datePicker,this);client.dateTime=target=new Date(a.year,a.month-1,a.day,a.hour,a.minutes);var t=new Date(a.year,a.month-1,a.day,a.hour,a.minutes),n=new Date(a.year,a.month-1,a.day,a.hour,a.minutes);t.setHours(target.getHours()-2),n.setHours(target.getHours()+2),$.ajax({url:"/api/v1/reservations",type:"GET",data:{start:t,end:n}}).error(function(e){console.log(e)}).done(function(e){if($tables.removeClass("reserved"),!e)return console.log("no reservations for this period");e.data&&(e=e.data),console.log("data",e);for(var a=0;a<e.length;a++){var t="#"+e[a].table;$(t).addClass("reserved")}})}),$(".tabs").on("click",".tab",function(){event.preventDefault();$(this).attr("rel");$(".tabs .tab").removeClass("active"),$(this).addClass("active")}),$(document).ready(function(){var e=$(".modal-notification"),a=function(a){$.ajax({url:"/login",type:"POST",data:a}).error(function(a){var t=a.responseJSON.error;400==a.status?t+=" (are you using localhost?)":403==a.status?t="Not authorized to access that resource.":401==a.status&&(t="Email or password not found."),e.html(t).finish().slideDown().delay(5e3).slideUp()}).done(function(e){window.location=e.location})};$(".login").on("submit",function(e){e.preventDefault(),a({u:e.target[0].value,p:e.target[1].value})}),$(".modal").find(".js-btn").on("click",function(){$(document.body).addClass("modal-open")}),$(".modal-close").on("click",function(){$(document.body).removeClass("modal-open")}),$(".modal-bg").on("click",function(){$(document.body).removeClass("modal-open")})});